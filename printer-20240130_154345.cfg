
[include shell_command.cfg]

# |------------------------|
# |        backpack        |
# |------------------------|
# | y  |    | z1 |    | x1 |
# |-----    ------    -----| 
# |                        |
# | ------          ------ |
# | | Z  |          | z2 | |
# | ------          ------ |
# |-----              -----|
# | x  |              | y1 |
# |------------------------|

[include mainsail.cfg]
[include macros.cfg]
[include led_effects.cfg]
[include K-ShakeTune/*.cfg]


# octopus pro 1.0
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_440037001251373234333632-if00
restart_method: command


[cartographer]
serial: /dev/serial/by-id/usb-Cartographer_614e_1B0011001443565537353020-if00
#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 40.
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: -21
#   X offset of cartographer from the nozzle.
y_offset: 0
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.0
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.0
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: x
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.



[board_pins]
aliases:
    # stepper drivers
    MOT0_EN=PF14, MOT0_STEP=PF13, MOT0_DIR=PF12, MOT0_CS=PC4,
    MOT1_EN=PF15, MOT1_STEP=PG0,  MOT1_DIR=PG1,  MOT1_CS=PD11,
    MOT2_EN=PG5,  MOT2_STEP=PF11, MOT2_DIR=PG3,  MOT2_CS=PC6,
    MOT3_EN=PA0,  MOT3_STEP=PG4,  MOT3_DIR=PC1,  MOT3_CS=PC7,
    MOT4_EN=PG2,  MOT4_STEP=PF9,  MOT4_DIR=PF10, MOT4_CS=PF2,
    MOT5_EN=PF1,  MOT5_STEP=PC13, MOT5_DIR=PF0,  MOT5_CS=PE4,
    MOT6_EN=PD4,  MOT6_STEP=PE2,  MOT6_DIR=PE3,  MOT6_CS=PE1,
    MOT7_EN=PE0,  MOT7_STEP=PE6,  MOT7_DIR=PA14, MOT7_CS=PD3,

    # heaters
    BED_OUT=PA1,
    HE0=PA2, HE1=PA3, HE2=PB10, HE3=PB11,

    # thermisors
    TB=PF3, T0=PF4, T1=PF5, T2=PF6, T3=PF7,
    PT1000=PF8,

    # fans
    FAN0=PA8, FAN1=PE5, FAN2=PD12, FAN3=PD13, FAN4=PD14, FAN5=PD15,

    # end stops
    ESTOP0=PG6,  ESTOP1=PG9,  ESTOP2=PG10, ESTOP3=PG11,
    ESTOP4=PG12, ESTOP5=PG13, ESTOP6=PG14, ESTOP7=PG15,

    # spi3
    SPI3_2=<3V3>, SPI3_MOSI=PB5, SPI3_CS=PA15, SPI3_8=<GND>, SPI3_10=<5V>,
    SPI3_1=<GND>, SPI3_MISO=PB4, SPI3_SCK=PB3, SPI3_7=<GND>, SPI3_9=<5V>,

[virtual_sdcard]
path: ~/printer_data/gcodes

[display_status]

[exclude_object]

[pause_resume]

[printer]
kinematics: cartesian
max_velocity: 500
max_accel: 18000
max_accel_to_decel: 15000
max_z_velocity: 15
max_z_accel: 100
square_corner_velocity: 15.0

[mcu rpi]
serial: /tmp/klipper_host_mcu

#[lis2dw]
#cs_pin: cartographer:PA3
#spi_bus: spi1

#[resonance_tester]
#accel_chip: lis2dw
#accel_per_hz: 100
#probe_points:
#    90, 90, 20

[gcode_arcs]
resolution: 0.1

[input_shaper]
# asa
#shaper_freq_x: 94.4
#shaper_freq_y: 93
#shaper_type: mzv


[stepper_x]
# connected to motor7
step_pin: MOT7_STEP
dir_pin: MOT7_DIR
enable_pin: !MOT7_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_x:virtual_endstop 
position_min: -8
position_endstop: 180
position_max: 180
homing_speed: 50.0
homing_retract_dist: 0
homing_positive_dir: true

[stepper_x1]
# connected to motor5
step_pin: MOT5_STEP
dir_pin: !MOT5_DIR
enable_pin: !MOT5_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_x1:virtual_endstop 

[stepper_y]
# connected to motor6
step_pin: MOT6_STEP
dir_pin: !MOT6_DIR
enable_pin: !MOT6_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_y:virtual_endstop 
position_min: -2
position_endstop: -2
position_max: 184
homing_speed: 50.0
homing_retract_dist: 0
homing_positive_dir: false

[stepper_y1]
# connected to motor4
step_pin: MOT4_STEP
dir_pin: MOT4_DIR
enable_pin: !MOT4_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_y1:virtual_endstop 

[stepper_z]
# connected to motor3
step_pin: MOT3_STEP
dir_pin: MOT3_DIR
enable_pin: !MOT3_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

# connected to virtual endstop
endstop_pin: probe:z_virtual_endstop
position_max: 170
position_min: -5
homing_speed: 15.0
second_homing_speed: 5.0
homing_retract_dist: 10.0
homing_positive_dir: false

[stepper_z1]
# connected to motor2
step_pin: MOT2_STEP
dir_pin: MOT2_DIR
enable_pin: !MOT2_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

[stepper_z2]
# connected to motor1
step_pin: MOT1_STEP
dir_pin: !MOT1_DIR
enable_pin: !MOT1_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

[tmc2209 stepper_x]
uart_pin: MOT7_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP7
driver_SGTHRS: 150

[tmc2209 stepper_x1]
uart_pin: MOT5_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP5
driver_SGTHRS: 150
# 
[tmc2209 stepper_y]
uart_pin: MOT6_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP6
driver_SGTHRS: 150

[tmc2209 stepper_y1]
uart_pin: MOT4_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP4
driver_SGTHRS: 150
 
[tmc2209 stepper_z]
uart_pin: MOT3_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z1]
uart_pin: MOT2_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z2]
uart_pin: MOT1_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[force_move]
enable_force_move: true

[safe_z_home]
home_xy_position: 90,90
# Example home_xy_position: 175,175 - This would be for a 350 * 350mm bed. 
z_hop: 10


[extruder]
# connected to motor0
step_pin: MOT0_STEP
dir_pin: MOT0_DIR
enable_pin: !MOT0_EN
rotation_distance: 22.39 #for 5mm Shaft Driven Bondtech gearsets
gear_ratio: 20:1 # sherpa mini 10t uses 5:1 or 8t uses 50:8, folded ascender use 40:1 or 20:1
microsteps: 4
full_steps_per_rotation: 200 # 1.8 deg motor

nozzle_diameter: 0.400

pressure_advance: 0.007 # DFA default PA value
pressure_advance_smooth_time: 0.04
filament_diameter: 1.750	
max_extrude_only_distance: 1400.0
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 1500.0
max_extrude_cross_section: 20000.0

# connected to he0
heater_pin: HE2
max_power: 1.0

sensor_type: ATC Semitec 104GT-2
sensor_pin: PF4



min_extrude_temp: 200
min_temp: 0
max_temp: 300

[tmc2209 extruder]
uart_pin: MOT0_CS
interpolate: true
run_current: 0.30 # up to 0.35A
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: HE0
# NTC 100K MGB18-104F39050L32 is for Kenovo thermistors
sensor_type: NTC 100K MGB18-104F39050L32
# connected to tb
sensor_pin: TB
smooth_time: 3.0

# build plate PID settings
max_power: 0.8
#control: pid
# 60 C, 100% PCF
#pid_Kp: 24.812
#pid_Ki: 1.125
#pid_Kd: 136.774
min_temp: 0
max_temp: 120

# raspberry pi temperature sensor
[temperature_sensor pi_cpu]
sensor_type: temperature_host
gcode_id: P

[temperature_sensor Mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100



# fans
# hotend cooling fan
[heater_fan hotend_fan]
# connected to fan0
pin: FAN0
max_power: 1.0
hardware_pwm: false
kick_start_time: 0.500
heater: extruder
heater_temp: 50.0
fan_speed: 1.00

[multi_pin part_cooling]
pins: FAN1, FAN2

# print cooling fan
[fan]
# connected to fan1
pin: multi_pin:part_cooling
max_power: 1.0
kick_start_time: 0.500

# backpack cooling fan  
[controller_fan electronics_fan_1]
# connected to fan3
pin: FAN3
max_power: 1.0
kick_start_time: 0.500
fan_speed: 1.00
idle_timeout: 60
heater: heater_bed
stepper: stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2

[controller_fan electronics_fan_2]
pin: FAN4
max_power: 1.0
kick_start_time: 0.500
fan_speed: 1.00
idle_timeout: 60
heater: heater_bed
stepper: stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2

[bed_mesh]
speed: 300
horizontal_move_z: 5
mesh_min: 20, 25
mesh_max: 150, 155
probe_count: 25, 25
fade_start: 0.5
fade_end: 10
mesh_pps: 0,0
zero_reference_position: 90, 90

[z_tilt]
# 3 z motors
z_positions: 
    -74.0, -18.0    # front left
    76.0,  217.0    # rear
    226.0, -18.0    # front right
points:
    45, 25          # front left
    101, 160        # rear
    175, 25         # front right
speed: 200
horizontal_move_z: 20.0
retries: 4
retry_tolerance: 0.01

[idle_timeout]
timeout: 6000


[temperature_sensor chamber_temp]
## Chamber Temperature - T1
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF5
min_temp: 0
max_temp: 100
gcode_id: chamber_th

[temperature_sensor extruder_temp]
## Chamber Temperature - T1
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF6
min_temp: 0
max_temp: 150
gcode_id: extruder_th

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 38.825
#*# pid_ki = 2.157
#*# pid_kd = 174.713
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 18.159
#*# pid_ki = 1.084
#*# pid_kd = 76.040
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 121.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 90.4