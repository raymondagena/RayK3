
[include shell_command.cfg]

# |------------------------|
# |        backpack        |
# |------------------------|
# | y  |    | z1 |    | x1 |
# |-----    ------    -----| 
# |                        |
# | ------          ------ |
# | | Z  |          | z2 | |
# | ------          ------ |
# |-----              -----|
# | x  |              | y1 |
# |------------------------|

[include mainsail.cfg]
[include macros.cfg]
[include led_effects.cfg]
[include K-ShakeTune/*.cfg]


# octopus pro 1.0
[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_440037001251373234333632-if00
restart_method: command


[cartographer]
serial: /dev/serial/by-id/usb-Cartographer_614e_1B0011001443565537353020-if00
#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 40.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: -21
#   X offset of cartographer from the nozzle.
y_offset: 0
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.0
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.0
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: x
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 3
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.



[board_pins]
aliases:
    # stepper drivers
    MOT0_EN=PF14, MOT0_STEP=PF13, MOT0_DIR=PF12, MOT0_CS=PC4,
    MOT1_EN=PF15, MOT1_STEP=PG0,  MOT1_DIR=PG1,  MOT1_CS=PD11,
    MOT2_EN=PG5,  MOT2_STEP=PF11, MOT2_DIR=PG3,  MOT2_CS=PC6,
    MOT3_EN=PA0,  MOT3_STEP=PG4,  MOT3_DIR=PC1,  MOT3_CS=PC7,
    MOT4_EN=PG2,  MOT4_STEP=PF9,  MOT4_DIR=PF10, MOT4_CS=PF2,
    MOT5_EN=PF1,  MOT5_STEP=PC13, MOT5_DIR=PF0,  MOT5_CS=PE4,
    MOT6_EN=PD4,  MOT6_STEP=PE2,  MOT6_DIR=PE3,  MOT6_CS=PE1,
    MOT7_EN=PE0,  MOT7_STEP=PE6,  MOT7_DIR=PA14, MOT7_CS=PD3,

    # heaters
    BED_OUT=PA1,
    HE0=PA2, HE1=PA3, HE2=PB10, HE3=PB11,

    # thermisors
    TB=PF3, T0=PF4, T1=PF5, T2=PF6, T3=PF7,
    PT1000=PF8,

    # fans
    FAN0=PA8, FAN1=PE5, FAN2=PD12, FAN3=PD13, FAN4=PD14, FAN5=PD15,

    # end stops
    ESTOP0=PG6,  ESTOP1=PG9,  ESTOP2=PG10, ESTOP3=PG11,
    ESTOP4=PG12, ESTOP5=PG13, ESTOP6=PG14, ESTOP7=PG15,

    # spi3
    SPI3_2=<3V3>, SPI3_MOSI=PB5, SPI3_CS=PA15, SPI3_8=<GND>, SPI3_10=<5V>,
    SPI3_1=<GND>, SPI3_MISO=PB4, SPI3_SCK=PB3, SPI3_7=<GND>, SPI3_9=<5V>,

[virtual_sdcard]
path: ~/printer_data/gcodes

[display_status]

[exclude_object]

[pause_resume]

[printer]
kinematics: cartesian
max_velocity: 500
max_accel: 18000
max_accel_to_decel: 15000
max_z_velocity: 15
max_z_accel: 100
square_corner_velocity: 15.0

[mcu rpi]
serial: /tmp/klipper_host_mcu

#[lis2dw]
#cs_pin: cartographer:PA3
#spi_bus: spi1

#[resonance_tester]
#accel_chip: lis2dw
#accel_per_hz: 100
#probe_points:
#    90, 90, 20

[gcode_arcs]
resolution: 0.1

[input_shaper]
# asa
#shaper_freq_x: 94.4
#shaper_freq_y: 93
#shaper_type: mzv


[stepper_x]
# connected to motor7
step_pin: MOT7_STEP
dir_pin: MOT7_DIR
enable_pin: !MOT7_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_x:virtual_endstop 
position_min: -8
position_endstop: 180
position_max: 180
homing_speed: 50.0
homing_retract_dist: 0
homing_positive_dir: true

[stepper_x1]
# connected to motor5
step_pin: MOT5_STEP
dir_pin: !MOT5_DIR
enable_pin: !MOT5_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_x1:virtual_endstop 

[stepper_y]
# connected to motor6
step_pin: MOT6_STEP
dir_pin: !MOT6_DIR
enable_pin: !MOT6_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_y:virtual_endstop 
position_min: -2
position_endstop: -2
position_max: 184
homing_speed: 50.0
homing_retract_dist: 0
homing_positive_dir: false

[stepper_y1]
# connected to motor4
step_pin: MOT4_STEP
dir_pin: MOT4_DIR
enable_pin: !MOT4_EN
# 20t pulley, 2mm pitch on a 0.9 deg motor
rotation_distance: 40
microsteps: 64
full_steps_per_rotation: 400
# connected to virtual endstop
endstop_pin: tmc2209_stepper_y1:virtual_endstop 

[stepper_z]
# connected to motor3
step_pin: MOT3_STEP
dir_pin: MOT3_DIR
enable_pin: !MOT3_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

# connected to virtual endstop
endstop_pin: probe:z_virtual_endstop
position_max: 170
position_min: -5
homing_speed: 15.0
second_homing_speed: 5.0
homing_retract_dist: 0
homing_positive_dir: false

[stepper_z1]
# connected to motor2
step_pin: MOT2_STEP
dir_pin: MOT2_DIR
enable_pin: !MOT2_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

[stepper_z2]
# connected to motor1
step_pin: MOT1_STEP
dir_pin: !MOT1_DIR
enable_pin: !MOT1_EN
# 5:1 belted z attached to a 1.8 deg motor
rotation_distance: 40
gear_ratio: 5:1
microsteps: 128
full_steps_per_rotation: 200

[tmc2209 stepper_x]
uart_pin: MOT7_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP7
driver_SGTHRS: 145

[tmc2209 stepper_x1]
uart_pin: MOT5_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP5
driver_SGTHRS: 145
# 
[tmc2209 stepper_y]
uart_pin: MOT6_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP6
driver_SGTHRS: 145

[tmc2209 stepper_y1]
uart_pin: MOT4_CS
interpolate: true
run_current: 1.0
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0
diag_pin: ESTOP4
driver_SGTHRS: 145
 
[tmc2209 stepper_z]
uart_pin: MOT3_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z1]
uart_pin: MOT2_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[tmc2209 stepper_z2]
uart_pin: MOT1_CS
interpolate: true
run_current: 1.0 
sense_resistor: 0.110
stealthchop_threshold: 999999

[force_move]
enable_force_move: true

[safe_z_home]
home_xy_position: 90,90
z_hop: 5


[extruder]
# connected to motor0
step_pin: MOT0_STEP
dir_pin: MOT0_DIR
enable_pin: !MOT0_EN
rotation_distance: 22.39 #for 5mm Shaft Driven Bondtech gearsets
gear_ratio: 20:1 # sherpa mini 10t uses 5:1 or 8t uses 50:8, folded ascender use 40:1 or 20:1
microsteps: 4
full_steps_per_rotation: 200 # 1.8 deg motor

nozzle_diameter: 0.400

pressure_advance: 0.007 # DFA default PA value
pressure_advance_smooth_time: 0.04
filament_diameter: 1.750	
max_extrude_only_distance: 1400.0
max_extrude_only_velocity: 75.0
max_extrude_only_accel: 1500.0
max_extrude_cross_section: 20000.0

# connected to he0
heater_pin: HE2
max_power: 1.0

sensor_type: ATC Semitec 104GT-2
sensor_pin: PF4



min_extrude_temp: 200
min_temp: 0
max_temp: 300

[tmc2209 extruder]
uart_pin: MOT0_CS
interpolate: true
run_current: 0.30 # up to 0.35A
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: HE0
# NTC 100K MGB18-104F39050L32 is for Kenovo thermistors
sensor_type: NTC 100K MGB18-104F39050L32
# connected to tb
sensor_pin: TB
smooth_time: 3.0

# build plate PID settings
max_power: 0.8
#control: pid
# 60 C, 100% PCF
#pid_Kp: 24.812
#pid_Ki: 1.125
#pid_Kd: 136.774
min_temp: 0
max_temp: 120

# raspberry pi temperature sensor
[temperature_sensor pi_cpu]
sensor_type: temperature_host
gcode_id: P

[temperature_sensor Mcu_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100



# fans
# hotend cooling fan
[heater_fan hotend_fan]
# connected to fan0
pin: FAN0
max_power: 1.0
hardware_pwm: false
kick_start_time: 0.500
heater: extruder
heater_temp: 50.0
fan_speed: 1.00

[multi_pin part_cooling]
pins: FAN1, FAN2

# print cooling fan
[fan]
# connected to fan1
pin: multi_pin:part_cooling
max_power: 1.0
kick_start_time: 0.500

# backpack cooling fan  
[controller_fan electronics_fan_1]
# connected to fan3
pin: FAN3
max_power: 1.0
kick_start_time: 0.500
fan_speed: 1.00
idle_timeout: 60
heater: heater_bed
stepper: stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2

[controller_fan electronics_fan_2]
pin: FAN4
max_power: 1.0
kick_start_time: 0.500
fan_speed: 1.00
idle_timeout: 60
heater: heater_bed
stepper: stepper_x, stepper_x1, stepper_y, stepper_y1, stepper_z, stepper_z1, stepper_z2

[bed_mesh]
speed: 250
horizontal_move_z: 2
mesh_min: 20, 25
mesh_max: 150, 155
zero_reference_position: 90,90
probe_count: 20, 20
fade_start: 0.5
fade_end: 10
mesh_pps: 2, 2
algorithm: bicubic
bicubic_tension: 0.2


[z_tilt]
# 3 z motors
z_positions: 
    -74.0, -18.0    # front left
    100.0,  217.0    # rear
    226.0, -18.0    # front right
points:
  111, 160        # Rear
  180, 13         # Front Right
  40, 13          # Front Left
speed: 300
horizontal_move_z: 5.0
retries: 4
retry_tolerance: 0.01

[idle_timeout]
timeout: 6000


[temperature_sensor chamber_temp]
## Chamber Temperature - T1
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF5
min_temp: 0
max_temp: 100
gcode_id: chamber_th

[temperature_sensor extruder_temp]
## Chamber Temperature - T1
sensor_type: ATC Semitec 104GT-2
sensor_pin: PF6
min_temp: 0
max_temp: 150
gcode_id: extruder_th

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 38.825
#*# pid_ki = 2.157
#*# pid_kd = 174.713
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 18.159
#*# pid_ki = 1.084
#*# pid_kd = 76.040
#*#
#*# [input_shaper]
#*# shaper_type_x = zv
#*# shaper_freq_x = 121.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 90.4
#*#
#*# [cartographer model default]
#*# model_coef = 1.3943030955961286,
#*# 	  1.834487485503095,
#*# 	  0.7785891936665239,
#*# 	  0.3483171409765805,
#*# 	  0.34558576971878147,
#*# 	  0.365840899006042,
#*# 	  -0.17398761169520446,
#*# 	  -0.2941440090573127,
#*# 	  0.2060066567677856,
#*# 	  0.19678262736575636
#*# model_domain = 3.2203202020239535e-07,3.339249542735002e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 26.848833
#*# model_offset = 0.34000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.010372, 0.021028, 0.024846, 0.009090, 0.023010, 0.019650, 0.020742, 0.025131, 0.021229, 0.015082, 0.018350, 0.017782, 0.012816, 0.011833, 0.010531, 0.010536, 0.012354, 0.019152, 0.031011, 0.039580
#*# 	  0.002433, 0.011789, 0.009029, 0.001176, 0.011956, 0.008875, 0.004913, 0.002313, 0.004757, 0.016167, 0.000925, -0.000900, -0.003329, 0.001879, -0.001918, -0.003615, 0.000242, 0.004987, 0.012694, 0.017165
#*# 	  0.004370, 0.009231, -0.001192, -0.009376, 0.000444, 0.005181, -0.000052, -0.009862, -0.000406, -0.002173, -0.001039, -0.008135, -0.011285, -0.014244, -0.011635, -0.006911, -0.006227, -0.001258, 0.005271, 0.010509
#*# 	  -0.000832, -0.003730, -0.006161, -0.003700, -0.005792, -0.005860, 0.000112, -0.001862, -0.001082, 0.002147, 0.002896, -0.004784, -0.006669, -0.003269, -0.011356, -0.016028, -0.014155, -0.016709, -0.008185, 0.000428
#*# 	  0.004541, -0.000965, 0.010318, 0.013280, 0.010486, 0.006125, -0.003740, 0.006582, 0.003697, -0.000635, 0.000131, 0.009311, 0.014946, 0.006411, 0.009609, 0.006578, 0.004565, -0.003202, -0.006631, -0.000688
#*# 	  -0.003719, -0.001506, 0.005171, 0.003786, 0.002403, -0.004673, 0.000474, -0.000565, 0.007451, 0.008844, 0.014477, -0.013614, 0.004635, -0.001777, -0.017072, -0.011972, 0.002554, -0.017545, -0.019657, -0.009588
#*# 	  -0.013860, -0.009662, -0.001639, -0.010558, -0.004734, 0.006675, 0.004788, -0.012773, -0.008751, 0.006305, 0.009218, -0.009856, -0.000610, 0.014443, 0.004729, 0.007745, 0.013541, 0.008522, 0.007614, 0.003434
#*# 	  -0.010377, -0.006169, -0.000135, -0.010591, -0.008095, -0.002721, -0.005233, 0.004060, -0.005284, -0.004748, 0.007112, -0.000314, -0.004076, 0.010213, 0.004039, 0.000565, 0.010747, 0.014941, -0.007427, -0.012404
#*# 	  -0.011241, -0.002756, -0.004151, -0.014134, -0.012136, -0.010553, -0.009318, 0.018773, 0.000047, -0.007566, -0.006901, 0.008618, 0.001617, -0.006729, 0.001594, -0.008218, -0.000825, 0.008721, -0.005429, -0.009133
#*# 	  -0.015826, -0.006461, -0.001350, -0.000297, 0.001534, -0.016982, -0.007696, 0.000279, 0.016256, -0.000064, -0.002117, 0.000478, -0.001953, -0.036351, -0.013480, -0.028704, -0.012080, 0.006903, -0.005057, -0.014410
#*# 	  -0.019775, -0.001544, 0.003872, -0.007398, -0.004179, -0.009528, -0.019423, -0.016720, 0.023168, -0.006376, -0.008344, -0.014354, -0.006175, -0.020392, -0.018116, -0.027210, -0.010172, -0.001466, -0.015118, -0.016835
#*# 	  -0.003269, 0.007120, 0.009260, -0.004516, -0.012113, -0.012132, -0.015404, 0.009980, 0.011924, 0.001035, -0.002932, -0.009461, -0.002172, -0.006448, -0.002383, -0.011054, -0.001615, 0.005158, -0.003763, 0.000966
#*# 	  0.008077, 0.016723, 0.020944, 0.009599, -0.001042, -0.003750, 0.008182, 0.019942, 0.012104, 0.003408, -0.008706, -0.009983, 0.001123, 0.002936, -0.004233, -0.000557, 0.000094, 0.000627, -0.008281, 0.001704
#*# 	  0.028419, 0.033806, 0.032149, 0.025207, 0.019288, 0.006213, 0.024904, 0.013129, 0.008468, -0.001884, 0.014262, 0.004264, 0.005738, 0.014440, 0.003873, -0.004571, 0.012615, 0.001769, -0.002705, 0.010439
#*# 	  0.041920, 0.043813, 0.045467, 0.039717, 0.028284, 0.027676, 0.047595, 0.023222, 0.016214, 0.008085, 0.005046, -0.005922, -0.006270, 0.013449, -0.001044, -0.009827, 0.013269, -0.010372, 0.018923, 0.024861
#*# 	  0.024868, 0.044456, 0.049963, 0.029384, 0.023866, 0.045825, 0.029982, 0.016941, 0.016764, 0.016136, 0.002628, 0.005419, 0.004337, 0.003985, -0.002055, -0.006192, 0.003003, 0.005005, 0.014327, 0.016760
#*# 	  0.043508, 0.054095, 0.049578, 0.033912, 0.026089, 0.050798, 0.010731, 0.014651, 0.020149, 0.017094, 0.011030, 0.005251, -0.001832, -0.002001, 0.005948, -0.002959, -0.000150, 0.006984, 0.015821, 0.015089
#*# 	  0.066642, 0.066963, 0.055488, 0.036084, 0.037222, 0.066826, 0.007139, 0.016954, 0.022626, 0.024232, 0.026437, 0.019311, 0.013726, 0.004223, 0.009403, -0.002946, 0.009901, 0.018799, 0.027680, 0.021896
#*# 	  0.065224, 0.069784, 0.061284, 0.058536, 0.080536, 0.029296, 0.016150, 0.021951, 0.032773, 0.039349, 0.039164, 0.032434, 0.028678, 0.023506, 0.007506, 0.012638, 0.016877, 0.018430, 0.017796, 0.033239
#*# 	  0.069847, 0.064415, 0.054828, 0.078172, 0.050141, 0.026739, 0.036953, 0.032309, 0.035942, 0.051889, 0.050502, 0.044070, 0.040052, 0.036958, 0.030709, 0.024697, 0.020337, 0.023776, 0.018351, 0.038365
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 20.0
#*# max_x = 150.0
#*# min_y = 25.0
#*# max_y = 155.0
